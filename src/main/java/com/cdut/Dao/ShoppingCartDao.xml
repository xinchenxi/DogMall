<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cdut.Dao.ShoppingCartDao">
    <resultMap id="ShoppingCartGoodsMap" type="com.cdut.Pojo.ShoppingCartGoods">
        <id property="goods.goodId" column="good_id"/>
        <result property="goods.goodName" column="good_name"/>
        <result property="goods.nums" column="nums"/>
        <result property="goods.price" column="price"/>
        <result property="goods.supplierId" column="supplier_id"/>
        <result property="goods.describe" column="describes"/>
        <result property="goods.imgurl" column="imgurl"/>
        <result property="goods.status" column="status"/>
        <result property="goodsnum" column="shoppingcart.cart_num"/>
    </resultMap>
    <select id="listCartByUserId" resultType="com.cdut.Pojo.ShoppingCartGoods" resultMap="ShoppingCartGoodsMap">
        select goods.*,shoppingcart.cart_nums from shoppingcart,goods where user_id=#{userId} and shoppingcart.good_id=goods.good_id;
    </select>
    <delete id="clearCart">
        delete from shoppingcart where user_id=#{userId};
    </delete>
    <select id="priceIncheckGoods" resultType="double">
        select sum(shoppingcart.cart_nums*goods.price) from shoppingcart,goods
        where (user_id=#{userId}
          and shoppingcart.good_id=goods.good_id
          and shoppingcart.good_id in (
        <foreach collection="goodsId" item="id" separator=",">
            #{id}
        </foreach>
        ));
    </select>
    <insert id="InsertGoods">
        insert into  shoppingcart values(#{userId},#{goodsId},#{nums});
    </insert>
    
    <delete id="deleteGoods">
        delete from shoppingcart where (user_id=#{userId}
                                 and good_id
                                 in (
                                 <foreach collection="goodsId" item="id" separator=",">
                                          #{id}
                                 </foreach>
                                    )  );
    </delete>

    <update id="increaseGoods">
        update  shoppingcart set cart_nums=cart_nums+1 where user_id=#{userId} and good_id=#{goodsId};
    </update>

    <update id="decreaseGoods">
        update  shoppingcart set cart_nums=cart_nums-1 where user_id=#{userId} and good_id=#{goodsId};
    </update>
    <select id="getGoodsnumsInCart" resultType="integer">
        select cart_nums from shoppingcart where user_id=#{userId} and good_id=#{goodsId};
    </select>
</mapper>